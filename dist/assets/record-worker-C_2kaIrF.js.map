{"version":3,"file":"record-worker-C_2kaIrF.js","sources":["../../../node_modules/@rrweb/record/dist/record-worker.js"],"sourcesContent":["(function() {\n  \"use strict\";\n  var chars = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n  var lookup = typeof Uint8Array === \"undefined\" ? [] : new Uint8Array(256);\n  for (var i = 0; i < chars.length; i++) {\n    lookup[chars.charCodeAt(i)] = i;\n  }\n  var encode = function(arraybuffer) {\n    var bytes = new Uint8Array(arraybuffer), i2, len = bytes.length, base64 = \"\";\n    for (i2 = 0; i2 < len; i2 += 3) {\n      base64 += chars[bytes[i2] >> 2];\n      base64 += chars[(bytes[i2] & 3) << 4 | bytes[i2 + 1] >> 4];\n      base64 += chars[(bytes[i2 + 1] & 15) << 2 | bytes[i2 + 2] >> 6];\n      base64 += chars[bytes[i2 + 2] & 63];\n    }\n    if (len % 3 === 2) {\n      base64 = base64.substring(0, base64.length - 1) + \"=\";\n    } else if (len % 3 === 1) {\n      base64 = base64.substring(0, base64.length - 2) + \"==\";\n    }\n    return base64;\n  };\n  const lastBlobMap = /* @__PURE__ */ new Map();\n  const transparentBlobMap = /* @__PURE__ */ new Map();\n  async function getTransparentBlobFor(width, height, dataURLOptions) {\n    const id = `${width}-${height}`;\n    if (\"OffscreenCanvas\" in globalThis) {\n      if (transparentBlobMap.has(id)) return transparentBlobMap.get(id);\n      const offscreen = new OffscreenCanvas(width, height);\n      offscreen.getContext(\"2d\");\n      const blob = await offscreen.convertToBlob(dataURLOptions);\n      const arrayBuffer = await blob.arrayBuffer();\n      const base64 = encode(arrayBuffer);\n      transparentBlobMap.set(id, base64);\n      return base64;\n    } else {\n      return \"\";\n    }\n  }\n  const worker = self;\n  worker.onmessage = async function(e) {\n    if (\"OffscreenCanvas\" in globalThis) {\n      const { id, bitmap, width, height, dataURLOptions } = e.data;\n      const transparentBase64 = getTransparentBlobFor(\n        width,\n        height,\n        dataURLOptions\n      );\n      const offscreen = new OffscreenCanvas(width, height);\n      const ctx = offscreen.getContext(\"2d\");\n      ctx.drawImage(bitmap, 0, 0);\n      bitmap.close();\n      const blob = await offscreen.convertToBlob(dataURLOptions);\n      const type = blob.type;\n      const arrayBuffer = await blob.arrayBuffer();\n      const base64 = encode(arrayBuffer);\n      if (!lastBlobMap.has(id) && await transparentBase64 === base64) {\n        lastBlobMap.set(id, base64);\n        return worker.postMessage({ id });\n      }\n      if (lastBlobMap.get(id) === base64) return worker.postMessage({ id });\n      worker.postMessage({\n        id,\n        type,\n        base64,\n        width,\n        height\n      });\n      lastBlobMap.set(id, base64);\n    } else {\n      return worker.postMessage({ id: e.data.id });\n    }\n  };\n})();\n//# sourceMappingURL=image-bitmap-data-url-worker-IJpC7g_b.js.map\n"],"names":["chars","lookup","Uint8Array","i","charCodeAt","encode","arraybuffer","i2","bytes","len","length","base64","substring","lastBlobMap","Map","transparentBlobMap","worker","self","onmessage","async","e","globalThis","postMessage","id","data","bitmap","width","height","dataURLOptions","transparentBase64","has","get","offscreen","OffscreenCanvas","getContext","blob","convertToBlob","arrayBuffer","set","drawImage","close","type"],"mappings":"0BAAA,UAAA,CAIE,QAFIA,EAAQ,mEACRC,EAA+B,OAAfC,WAAe,IAAc,CAAA,EAAK,IAAIA,WAAW,GAAA,EAC5DC,EAAI,EAAGA,EAAIH,GAAcG,IAChCF,EAAOD,EAAMI,WAAWD,CAAAA,CAAAA,EAAMA,EAEhC,IAAIE,EAAS,SAASC,EAAAA,CACpB,IAAyCC,EAArCC,EAAQ,IAAIN,WAAWI,CAAAA,EAAkBG,EAAMD,EAAME,OAAQC,EAAS,GAC1E,IAAKJ,EAAK,EAAGA,EAAKE,EAAKF,GAAM,EAC3BI,GAAUX,EAAMQ,EAAMD,CAAAA,GAAO,CAAA,EAC7BI,GAAUX,GAAmB,EAAZQ,EAAMD,CAAAA,IAAY,EAAIC,EAAMD,EAAK,CAAA,GAAM,CAAA,EACxDI,GAAUX,GAAuB,GAAhBQ,EAAMD,EAAK,CAAA,IAAY,EAAIC,EAAMD,EAAK,CAAA,GAAM,CAAA,EAC7DI,GAAUX,EAAsB,GAAhBQ,EAAMD,EAAK,CAAA,CAAA,EAO7B,OALIE,EAAM,GAAM,EACdE,EAASA,EAAOC,UAAU,EAAGD,EAAOD,OAAS,CAAA,EAAK,IACzCD,EAAM,GAAM,IACrBE,EAASA,EAAOC,UAAU,EAAGD,EAAOD,OAAS,CAAA,EAAK,MAE7CC,CACT,EACA,MAAME,EAA8B,IAAIC,IAClCC,EAAqC,IAAID,IAgBzCE,EAASC,KACfD,EAAOE,UAAYC,eAAeC,EAAAA,CAChC,GAAA,EAAI,oBAAqBC,YA6BvB,OAAOL,EAAOM,YAAY,CAAEC,GAAIH,EAAEI,KAAKD,EAAAA,CAAAA,EA7BJ,CACnC,KAAA,CAAMA,GAAEA,EAAEE,OAAEA,EAAMC,MAAEA,EAAKC,OAAEA,EAAMC,eAAEA,CAAAA,EAAmBR,EAAEI,KAClDK,EAnBVV,eAAqCO,EAAOC,EAAQC,EAAAA,CAClD,MAAML,EAAK,GAAGG,CAAAA,IAASC,CAAAA,GACvB,GAAI,oBAAqBN,WAAY,CACnC,GAAIN,EAAmBe,IAAIP,CAAAA,EAAK,OAAOR,EAAmBgB,IAAIR,CAAAA,EAC9D,MAAMS,EAAY,IAAIC,gBAAgBP,EAAOC,CAAAA,EAC7CK,EAAUE,WAAW,IAAA,EACrB,MAAMC,EAAAA,MAAaH,EAAUI,cAAcR,CAAAA,EACrCS,EAAAA,MAAoBF,EAAKE,YAAAA,EACzB1B,EAASN,EAAOgC,CAAAA,EAEtB,OADAtB,EAAmBuB,IAAIf,EAAIZ,CAAAA,EACpBA,CACT,CACE,MAAO,EAEX,EAMMe,EACAC,EACAC,CAAAA,EAEII,EAAY,IAAIC,gBAAgBP,EAAOC,CAAAA,EACjCK,EAAUE,WAAW,IAAA,EAC7BK,UAAUd,EAAQ,EAAG,CAAA,EACzBA,EAAOe,MAAAA,EACP,MAAML,EAAAA,MAAaH,EAAUI,cAAcR,CAAAA,EACrCa,EAAON,EAAKM,KACZJ,EAAAA,MAAoBF,EAAKE,YAAAA,EACzB1B,EAASN,EAAOgC,CAAAA,EACtB,GAAA,CAAKxB,EAAYiB,IAAIP,CAAAA,GAAAA,MAAaM,IAAsBlB,EAEtD,OADAE,EAAYyB,IAAIf,EAAIZ,CAAAA,EACbK,EAAOM,YAAY,CAAEC,GAAAA,CAAAA,CAAAA,EAE9B,GAAIV,EAAYkB,IAAIR,CAAAA,IAAQZ,EAAQ,OAAOK,EAAOM,YAAY,CAAEC,GAAAA,CAAAA,CAAAA,EAChEP,EAAOM,YAAY,CACjBC,GAAAA,EACAkB,KAAAA,EACA9B,OAAAA,EACAe,MAAAA,EACAC,OAAAA,CAAAA,CAAAA,EAEFd,EAAYyB,IAAIf,EAAIZ,CAAAA,CACtB,CAGF,CACD","x_google_ignoreList":[0]}